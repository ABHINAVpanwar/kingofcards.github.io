<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>KING OF CARDS</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../static/alert.css" />
    <link rel="icon" href="../static/IMG/icon.png" type="image/icon type" />
  </head>

  <body>
    <nav>
      <div class="logo"><img src="../static/IMG/logo.png" /></div>
      <input id="click" type="checkbox" />
      <label class="menu-btn" for="click"><i class="fas fa-bars"></i></label>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="player.html">Players</a></li>
        <li><a href="protection.html">Gallery</a></li>
        <li><a href="alert.html">Alert</a></li>
      </ul>
    </nav>
    <section class="container">
      <img src="../static/IMG/cover.jpg" />
      <h1 id="scroll">NEXT EDITION</h1>
    </section>
    <section class="S2">
      <h1 id="date">ON 10/11/2024</h1>
      <h2 id="countdown"></h2>
      <div id="D1">
        <table>
          <thead>
            <tr>
              <th>PLAYERS</th>
              <th>MONOPOLY</th>
              <th>BLUFF</th>
              <th>SPOON</th>
              <th>UNO</th>
              <th>MONOPOLY</th>
              <th>BLUFF</th>
              <th>SPOON</th>
              <th>UNO</th>
              <th>TOTAL</th>
            </tr>
          </thead>
          <tbody id="score-table"></tbody>
        </table>
      </div>
    </section>
    <script>
      let fun = document.getElementById("scroll");
      window.addEventListener("scroll", () => {
        let f = window.scrollY;
        fun.style.top = 240 + f * 0.7 + "px";
      });

      var now = new Date().getTime();
      var countDownDate = new Date("11/10/2024").getTime();
      var distance = countDownDate - now;
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));

      if (days <= 0) {
        document.getElementById("countdown").innerHTML =
          "LIVE <span class='blink'>*</span>";
      } else {
        document.getElementById("countdown").innerHTML = days + " DAYS LEFT";
      }

      const checkbox = document.getElementById("click");
      const s1 = document.getElementsByClassName("container");
      const s2 = document.getElementsByClassName("S2");

      checkbox.addEventListener("change", function () {
        if (checkbox.checked) {
          for (let i = 0; i < s1.length; i++) {
            s1[i].style.display = "none";
          }
          for (let i = 0; i < s2.length; i++) {
            s2[i].style.display = "none";
          }
        } else {
          for (let i = 0; i < s1.length; i++) {
            s1[i].style.display = "flex";
          }
          for (let i = 0; i < s2.length; i++) {
            s2[i].style.display = "flex";
          }
        }
      });
      fetch("http://127.0.0.1:5000//scores")
        .then((response) => response.json())
        .then((data) => {
          // Sort the players as before
          data.sort((a, b) => {
            const winsA = [
              a.monopoly1,
              a.bluff1,
              a.spoon1,
              a.uno1,
              a.monopoly2,
              a.bluff2,
              a.spoon2,
              a.uno2,
            ].filter((score) => score === 2).length;
            const winsB = [
              b.monopoly1,
              b.bluff1,
              b.spoon1,
              b.uno1,
              b.monopoly2,
              b.bluff2,
              b.spoon2,
              b.uno2,
            ].filter((score) => score === 2).length;

            return winsB - winsA || b.total - a.total;
          });

          // Clear existing rows before adding new ones
          const tableBody = document.getElementById("score-table");
          tableBody.innerHTML = "";

          data.forEach((player, index) => {
            const row = document.createElement("tr");

            if (index === 0) {
              row.classList.add("gold");
            } else if (index === 1) {
              row.classList.add("silver");
            } else {
              row.classList.add("white");
            }

            row.innerHTML = `
          <td>${player.name}</td>
          <td>${player.monopoly1}</td>
          <td>${player.bluff1}</td>
          <td>${player.spoon1}</td>
          <td>${player.uno1}</td>
          <td>${player.monopoly2}</td>
          <td>${player.bluff2}</td>
          <td>${player.spoon2}</td>
          <td>${player.uno2}</td>
          <td>${player.total}</td>
        `;
            tableBody.appendChild(row);
          });

          // Refresh the page after loading data
          setTimeout(() => location.reload(), 300000); // Refresh after 5 min
        })
        .catch((error) => console.error("Error fetching scores:", error));
    </script>
  </body>
</html>
