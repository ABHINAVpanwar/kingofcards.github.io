<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>KING OF CARDS</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../static/alert.css" />
    <link rel="icon" href="../static/IMG/icon.png" type="image/icon type" />
  </head>

  <body>
    <nav>
      <div class="logo"><img src="../static/IMG/logo.png" /></div>
      <input id="click" type="checkbox" />
      <label class="menu-btn" for="click"><i class="fas fa-bars"></i></label>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="player.html">Players</a></li>
        <li><a href="protection.html">Gallery</a></li>
        <li><a href="alert.html">Alert</a></li>
      </ul>
    </nav>
    <section class="container">
      <img src="../static/IMG/cover.jpg" />
      <h1 id="scroll">NEXT EDITION</h1>
    </section>
    <section class="S2">
      <h1 id="date">ON 8/4/2025</h1>
      <h2 id="countdown"></h2>
      <div id="D1">
        <table>
          <thead>
            <tr>
              <th>PLAYERS</th>
              <th class="hide">MONOPOLY</th>
              <th class="hide">BLUFF</th>
              <th class="hide">SPOON</th>
              <th class="hide">UNO</th>
              <th class="hide">MONOPOLY</th>
              <th class="hide">BLUFF</th>
              <th class="hide">SPOON</th>
              <th class="hide">UNO</th>
              <th>TOTAL</th>
            </tr>
          </thead>
          <tbody id="score-table"></tbody>
        </table>
      </div>
    </section>
    <div id="winner-overlay" class="hidden">
      <div class="celebration">
        <h1 id="winner-text"></h1>
        <div id="confetti-container"></div>
      </div>
    </div>
    <form
      id="form"
      action="https://api.web3forms.com/submit"
      method="POST"
      style="display: none"
    >
      <input type="hidden" name="subject" value="" id="subjectKeyInput" />
      <input type="hidden" name="access_key" value="" id="accessKeyInput" />
      <textarea name="message" class="wao" id="messageInput"></textarea>
    </form>
    <script>
      let fun = document.getElementById("scroll");
      window.addEventListener("scroll", () => {
        let f = window.scrollY;
        fun.style.top = 240 + f * 0.7 + "px";
      });

      var now = new Date().getTime();
      var countDownDate = new Date("4/8/2025").getTime();
      var distance = countDownDate - now;
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));

      if (days <= 0) {
        document.getElementById("countdown").innerHTML =
          "LIVE <span class='blink'>*</span>";
      } else {
        document.getElementById("countdown").innerHTML = days + " DAYS LEFT";
      }

      const checkbox = document.getElementById("click");
      const s1 = document.getElementsByClassName("container");
      const s2 = document.getElementsByClassName("S2");

      checkbox.addEventListener("change", function () {
        if (checkbox.checked) {
          for (let i = 0; i < s1.length; i++) {
            s1[i].style.display = "none";
          }
          for (let i = 0; i < s2.length; i++) {
            s2[i].style.display = "none";
          }
        } else {
          for (let i = 0; i < s1.length; i++) {
            s1[i].style.display = "flex";
          }
          for (let i = 0; i < s2.length; i++) {
            s2[i].style.display = "flex";
          }
        }
      });
      fetch("https://kingofcards-github-io.onrender.com/scores")
        .then((response) => response.json())
        .then((data) => {
          // Sort the players as before
          data.sort((a, b) => {
            const winsA = [
              a.monopoly1,
              a.bluff1,
              a.spoon1,
              a.uno1,
              a.monopoly2,
              a.bluff2,
              a.spoon2,
              a.uno2,
            ].filter((score) => score === 2).length;
            const winsB = [
              b.monopoly1,
              b.bluff1,
              b.spoon1,
              b.uno1,
              b.monopoly2,
              b.bluff2,
              b.spoon2,
              b.uno2,
            ].filter((score) => score === 2).length;

            return winsB - winsA || b.total - a.total;
          });

          // Clear existing rows before adding new ones
          const tableBody = document.getElementById("score-table");
          tableBody.innerHTML = "";

          let grandTotal = 0;
          let tableContent = `<table>`;

          data.forEach((player, index) => {
            tableContent += `
          <tr>
            <td>${player.name}</td>
            <td>${player.monopoly1}</td>
            <td>${player.bluff1}</td>
            <td>${player.spoon1}</td>
            <td>${player.uno1}</td>
            <td>${player.monopoly2}</td>
            <td>${player.bluff2}</td>
            <td>${player.spoon2}</td>
            <td>${player.uno2}</td>
            <td>${player.total}</td>
          </tr>`;

            const row = document.createElement("tr");

            if (index === 0) {
              row.classList.add("gold");
            } else if (index === 1) {
              row.classList.add("silver");
            } else {
              row.classList.add("white");
            }

            row.innerHTML = `
              <td>${player.name}</td>
              <td class="hide">${player.monopoly1}</td>
              <td class="hide">${player.bluff1}</td>
              <td class="hide">${player.spoon1}</td>
              <td class="hide">${player.uno1}</td>
              <td class="hide">${player.monopoly2}</td>
              <td class="hide">${player.bluff2}</td>
              <td class="hide">${player.spoon2}</td>
              <td class="hide">${player.uno2}</td>
              <td>${player.total}</td>
            `;
            tableBody.appendChild(row);
            grandTotal += player.total;
          });

          tableContent += `
          </table>`;

          if (grandTotal >= 2) {
            const winner = data[0].name;
            const winnerOverlay = document.getElementById("winner-overlay");
            const winnerText = document.getElementById("winner-text");
            const confettiContainer =
              document.getElementById("confetti-container");

            winnerText.textContent = `THE WINNER IS "${winner}"! ðŸŽ‰`;
            winnerOverlay.classList.remove("hidden");

            // Generate confetti
            for (let i = 0; i < 200; i++) {
              const confetti = document.createElement("div");
              confetti.classList.add("confetti");
              confetti.style.left = Math.random() * 100 + "vw";
              confetti.style.animationDelay = Math.random() * 3 + "s";
              confetti.style.background = `hsl(${
                Math.random() * 360
              }, 100%, 50%)`;
              confettiContainer.appendChild(confetti);
            }

            // Hide overlay after 1 min
            setTimeout(() => {
              winnerOverlay.classList.add("hidden");
              confettiContainer.innerHTML = ""; // Clear confetti
              const form = document.getElementById("form");
              const accessKeyInput = document.getElementById("accessKeyInput");
              const messageInput = document.getElementById("messageInput");
              const subjectKeyInput =
                document.getElementById("subjectKeyInput");

              if (winner === "ABHINAV") {
                accessKeyInput.value = "4b490f5d-d424-4b8a-8474-f18ac12f4b52";
              } else if (winner === "UTKARSH") {
                accessKeyInput.value = "4d6d075d-2a50-465e-acb1-6e59d6039eb6";
              }
              subjectKeyInput.value = `KING OF CARDS WINNER "${winner}"`;

              messageInput.value = `
Date: ${now}

Hi ${winner},

CONGRATULATIONS! ðŸŽ‰ Youâ€™ve officially claimed the throne as the King of Cards! ðŸ‘‘

Youâ€™ve not only survived, but DOMINATED Monopoly, outwitted the Bluff, snatched up all the spoons, and UNO-ed your way to victory like a true champion! Hereâ€™s a look at how you crushed the competition:

${tableContent}

Go ahead, bask in the glory of your hard-earned title. But remember, with great power comes great responsibility... to defend that crown at the next tournament. ðŸ˜œ You know weâ€™ll be coming for it! ðŸ˜‰

We canâ€™t wait to see you in action again. Keep practicing. 

Cheers,  
The King of Cards Team`;
              form.submit();
            }, 6000);
          }

          // Refresh the page after loading data
          setTimeout(() => location.reload(), 300000); // Refresh after 5 min
        })
        .catch((error) => console.error("Error fetching scores:", error));
    </script>
  </body>
</html>
